{% extends "template.html" %}
{% block title %}
    Last Predictions
{% endblock %}
{% block body %}
    <a href="/all_predictions">All Predictions</a>
    {#<p>
        <a class="btn btn-danger btn-sm" href="/predict">Predict Now</a>
    </p>#}
    <p>
        <a class="btn btn-primary btn-sm" href="/update_actual">Update actual</a>
    </p>
    <h1>Last predictions: </h1>
    <h4>Linreg: {{ tr }}/{{ l }} ({{ perc }}%)</h4>
    <div style="display: flex; flex-direction: row;">
        <div id="myChart"></div>
    </div>
    <br>
    <table class="table table-responsive table-sm table-striped">
        <thead>
        <tr>
            <td>Name</td>
            <td>Percent</td>
            <td>Pred.time price</td>
            <td>Prediction</td>
            {#<td>Created</td>
            <td>Updated*</td>#}
        </tr>
        </thead>
        <tbody>
        {% for prediction in predictions %}
            <tr>
                <td>{{ prediction.company.name }}</td>
                <td>{{ prediction.true }}/{{ prediction.count }}
                    {{ prediction.percent }}%
                </td>

                <td>{{ "%.5f"|format(prediction.current) }}</td>
                <td>
                    {% if prediction.trend %}
                        <span style="color: forestgreen;">{{ "%.5f"|format(prediction.prediction) }} ↑</span>
                    {% else %}
                        <span style="color:lightcoral">{{ "%.5f"|format(prediction.prediction) }} ↓</span>
                    {% endif %}
                </td>
                {#<td>{{ prediction.time }}</td>
                <td>{{ prediction.updated_at }}</td>#}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {#    <p>* - prediction price not updated since created</p>#}

    <script src="/js/pie-chart.js"></script>
    <script>
        var data = [{
            values: [{{ tr }}, {{ l-tr }}],
            labels: ['True', 'False'],
            type: 'pie',
            name: "Linreg predictions",
            marker: {
                colors: ["rgba(19, 136, 8, 0.8)", "rgba(248, 0, 0,0.8)"]
            }
        }];

        var layout = {
            height: 300,
            width: 300
        };

        Plotly.newPlot('myChart', data, layout, {responsive: true});
    </script>
{% endblock %}
