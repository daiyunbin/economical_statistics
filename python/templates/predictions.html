{% extends "template.html" %}
{% block title %}
    Last Predictions
{% endblock %}
{% block body %}
    <a href="/all_predictions">All Predictions</a>
    <p>
        <a class="btn btn-danger btn-sm" href="/predict">Predict Now</a>
    </p>
    <p>
        <a class="btn btn-primary btn-sm" href="/update_actual">Update actual</a>
    </p>
    <h1>Last predictions: </h1>
    <h4>Linreg: {{ tr }}/{{ l }} ({{ perc }}%)</h4>
    <div style="display: flex; flex-direction: row;">
        <div style="width: 50%; max-height: 100%;text-align: center">
            <h3>Linreg:</h3>
            <canvas id="myChart"></canvas>
        </div>
    </div>
    <br>
    <table class="table table-responsive table-sm table-striped">
        <thead>
        <tr>
            <td>Name</td>
            <td>Percent</td>
            <td>MA Percent</td>
            <td>Pred.time price</td>
            <td>Prediction</td>
            <td>Created</td>
            <td>Updated*</td>
        </tr>
        </thead>
        <tbody>
        {% for prediction in predictions %}
            <tr>
                <td>{{ prediction.company.name }}</td>
                <td>{{ prediction.true }}/{{ prediction.count }}
                    {{ prediction.percent }}%
                </td>
                <td>{{ "%.2f"|format(prediction.ma_percent) }}%</td>

                <td>{{ "%.5f"|format(prediction.current) }}</td>
                <td>
                    {% if prediction.trend %}
                        <span style="color: forestgreen;">{{ "%.5f"|format(prediction.prediction) }} ↑</span>
                    {% else %}
                        <span style="color:lightcoral">{{ "%.5f"|format(prediction.prediction) }} ↓</span>
                    {% endif %}
                </td>
                <td>{{ prediction.time }}</td>
                <td>{{ prediction.updated_at }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <p>* - prediction price not updated since created</p>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
    <script>
        let ctx = document.getElementById('myChart').getContext('2d');
        let data = {
            datasets: [{
                data: [{{ tr }}, {{ l - tr }}],
                backgroundColor: ["rgba(19, 136, 8, 0.8)", "rgba(248, 0, 0,0.8)"]
            }],
            labels: [
                'True',
                'False',
            ]
        };
        let myPieChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                rotation: 0.5 * Math.PI,
            }
        })
    </script>
{% endblock %}
